name: Setup Branch Protection Rules

on:
  push:
    branches:
      - main
      - development

permissions:
  admin: write
  contents: write

jobs:
  setup:
    runs-on: ubuntu-latest
    if: github.run_number == 1 # Se ejecutará sólo en la primera ejecución del workflow
    steps:
      - name: Set up branch protection for main and development
        run: |
          for branch in main development; do
            curl -X PUT \
                 -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                 -H "Accept: application/vnd.github.v3+json" \
                 https://api.github.com/repos/${{ github.repository }}/branches/$branch/protection \
                 -d '{
                   "required_pull_request_reviews": {
                     "dismissal_restrictions": {},
                     "dismiss_stale_reviews": true
                   },
                   "required_signatures": true,
                   "enforce_admins": true,
                   "required_status_checks": null,
                   "restrictions": null
                 }'
          done
